<html>
<head>
    <meta charset="UTF-8">
    <title>Index</title>
</head>

<body>
    <center>
    <img src="resources/inicio.jpg">
    
    <h1 > Ingrese su nombre de usuario </h1>
    <input  id = "username" type="text">
    <button onclick="enviar_datos(document.getElementById('username').value)" > Comenzar </button>
  </center>
    
    <script>

      var vista_lobby = '<center> <div lobby_titulo></div>'+
      '<div id = "tiempo0"></div>'+
      '<div id = "usuarios_lobby"></div> </center>';

      var vista_principal = '<center> <div id = pregunta_id></div>'+
    '<div id = pregunta_actual></div>'+
    '<div id = pregunta_opcion></div>'+
    '<div id = score></div>'+
    '<div id = timer></div>'+
    '<button id = opcion1> </button><br>'+
    '<button id = opcion2> </button><br>'+
    '<button id = opcion3> </button><br>'+
    '<button id = opcion4> </button><br>'+
    '<div id= chat></div>'+
    '<div id= text></div><center>';
      
    var vista_resultados = '<div>Resultados</div>'+
    '<div id = lista_ganadores></div>';
      
      var Inicio = true;
      var dataValida = false;
      var lobby = false;
      var time = 0;
      var mensaje_servidor = '';

    function enviar_datos(username){
      const ws = new WebSocket("wss://trivia.tallerdeintegracion.cl/connect");
      ws.addEventListener("open", () => {
      console.log("You are connected to server");
    
      ws.send(JSON.stringify({
          "type":"join",
          "id":"f8c064f3-9700-4a08-a857-dad9b2012fbf",
          "username": document.getElementById('username').value
        }));

      ws.onmessage = function (msg) {
        //paso mensaje de Type Mensagge a type string
          var string1 = String(msg.data);
          
          
          //paso de type string a json para utilizar data
          var parsed = JSON.parse(string1);
          console.log(parsed);
        
          //solicitud denegada: error
          if(parsed["type"]  == "denied") {
            document.write("Solicitud denegada. Motivo:"+parsed["reason"]);

            //mostrar el lobby
          } else if (parsed["type"]  == "lobby") {
            document.write("");
            document.write(vista_lobby);

            document.getElementById("tiempo0").innerHTML = ("Esperando. Tiempo restante:"+parsed["seconds_remaining"]);
            var lista_lobby = parsed["players"];
            var element = lista_lobby.map( (e,i) => (i+1+"."+e) ).join(' ');
            document.getElementById("usuarios_lobby").innerHTML = ("Jugadores Conectados :"+ element);
              
          } else if (parsed["type"]  == "timer") {
            document.getElementById("timer").innerHTML = ("Tiempo restante "+ parsed["seconds_remaining"]);

          } else if (parsed["type"] == "question"){
            document.write("");
            document.write(vista_principal);
            document.getElementById("pregunta_id").innerHTML = ("Question "+ parsed["question_id"]);
            document.getElementById("pregunta_actual").innerHTML = (parsed["question_title"]);

            if (parsed["question_type"] == "button"){

              document.getElementById("opcion1").innerHTML = ("1 : "+parsed["question_options"]["1"]);
              document.getElementById("opcion2").innerHTML = ("2 : "+parsed["question_options"]["2"]);
              document.getElementById("opcion3").innerHTML = ("3 : "+parsed["question_options"]["3"]);
              document.getElementById("opcion4").innerHTML = ("4 : "+parsed["question_options"]["4"]);

            
            }else (parsed["question_type"] == "text").innerHTML = ("Escribe tu respuesta     ");
              

          } else if (parsed["type"] == "chat"){
            document.write("");
            document.write(parsed["username"]+" : "+ parsed["message"]);
            

  
          } else if (parsed["type"] == "highscore"){
            document.write("")
            var lista_ganadores = parsed["winners"]
            var lista_ganadores1 = lista_lobby.map( (e,i) => (i+1+"."+e) ).join(' ');
            document.getElementById("lista_ganadores").innerHTML = (lista_ganadores);

          } else {
            //document.write("cagaste")
          }
          
        };
      });
  
    }
    </script>

<style>
  h1 {
font-family: Impact, sans-serif;
color: #8A2BE2;
text-align: center
};

</style>

</body>
</html>